import { useRef, useState } from 'react';
import type { ChangeEvent } from 'react';

function ProfilePlaceholder() {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="128"
      height="128"
      viewBox="0 0 128 128"
      fill="none"
    >
      <circle cx="64" cy="64" r="63.5" fill="white" stroke="#CCCCCC" />
      <path
        d="M55.3268 45.7743C56.7437 47.2735 56.2329 49.7095 54.3429 50.5361L30.3561 61.0272C28.4262 61.8713 26.2574 60.5194 26.1928 58.414C26.0202 52.7943 25.8317 43.1184 26.3506 37.7721C26.7597 33.5562 27.8683 29.7938 28.6595 27.5255C29.1233 26.1959 30.5043 25.4954 31.823 25.9896C33.855 26.7511 37.0031 28.2357 40.3147 30.9568C44.2331 34.1765 51.3528 41.5691 55.3268 45.7743Z"
        fill="#111111"
      />
      <path
        d="M57.1257 50.3426C58.5425 51.8419 58.0317 54.2778 56.1417 55.1044L32.1549 65.5956C30.2251 66.4397 28.0563 65.0877 27.9916 62.9823C27.819 57.3627 27.6306 47.6868 28.1494 42.3405C28.5585 38.1246 29.6671 34.3622 30.4583 32.0939C30.9221 30.7643 32.3032 30.0638 33.6218 30.5579C35.6538 31.3194 38.8019 32.8041 42.1136 35.5252C46.032 38.7448 53.1516 46.1374 57.1257 50.3426Z"
        fill="#D9D9D9"
      />
      <path
        d="M73.1585 45.7743C71.7417 47.2735 72.2525 49.7095 74.1424 50.5361L98.1293 61.0272C100.059 61.8713 102.228 60.5194 102.293 58.414C102.465 52.7943 102.654 43.1184 102.135 37.7721C101.726 33.5562 100.617 29.7938 99.8258 27.5255C99.362 26.1959 97.981 25.4954 96.6624 25.9896C94.6303 26.7511 91.4823 28.2357 88.1706 30.9568C84.2522 34.1765 77.1326 41.5691 73.1585 45.7743Z"
        fill="#111111"
      />
      <path
        d="M71.4549 50.3426C70.0381 51.8419 70.5489 54.2778 72.4388 55.1044L96.4256 65.5956C98.3555 66.4397 100.524 65.0877 100.589 62.9823C100.762 57.3627 100.95 47.6868 100.431 42.3405C100.022 38.1246 98.9135 34.3622 98.1222 32.0939C97.6584 30.7643 96.2774 30.0638 94.9588 30.5579C92.9267 31.3194 89.7787 32.8041 86.467 35.5252C82.5486 38.7448 75.4289 46.1374 71.4549 50.3426Z"
        fill="#D9D9D9"
      />
      <ellipse
        cx="64.1681"
        cy="71.9639"
        rx="42.0275"
        ry="30.9527"
        fill="#111111"
      />
      <path
        d="M22.7562 80.3105C23.7864 79.1663 25.6688 79.5665 26.1446 81.0307L26.4355 81.926C26.9112 83.3903 25.6235 84.8205 24.1175 84.5004L23.1967 84.3046C21.6908 83.9845 21.0961 82.1542 22.1263 81.0101L22.7562 80.3105Z"
        fill="#111111"
      />
      <path
        d="M105.244 80.3105C104.214 79.1663 102.331 79.5665 101.856 81.0307L101.565 81.926C101.089 83.3903 102.377 84.8205 103.883 84.5004L104.804 84.3046C106.309 83.9845 106.904 82.1542 105.874 81.0101L105.244 80.3105Z"
        fill="#111111"
      />
      <path
        d="M25.7291 86.2297C26.5393 85.0355 28.3091 85.0664 29.0772 86.2881L29.8138 87.4597C30.6595 88.8049 29.6744 90.5516 28.0857 90.5239L26.5722 90.4974C24.9834 90.4697 24.0599 88.6897 24.9521 87.3748L25.7291 86.2297Z"
        fill="#111111"
      />
      <path
        d="M102.271 86.2297C101.461 85.0355 99.6909 85.0664 98.9228 86.2881L98.1862 87.4597C97.3405 88.8049 98.3256 90.5516 99.9143 90.5239L101.428 90.4974C103.017 90.4697 103.94 88.6897 103.048 87.3748L102.271 86.2297Z"
        fill="#111111"
      />
    </svg>
  );
}

function PencilIcon() {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="12"
      height="12"
      viewBox="0 0 12 12"
      fill="none"
    >
      <path
        d="M1.33333 10.6667H2.28333L8.8 4.15L7.85 3.2L1.33333 9.71667V10.6667ZM0.666667 12C0.477778 12 0.319556 11.936 0.192 11.808C0.0644445 11.68 0.000444444 11.5218 0 11.3333V9.71667C0 9.53889 0.0333334 9.36933 0.1 9.208C0.166667 9.04667 0.261111 8.90511 0.383333 8.78333L8.8 0.383333C8.93333 0.261111 9.08067 0.166667 9.242 0.1C9.40333 0.0333334 9.57267 0 9.75 0C9.92733 0 10.0996 0.0333334 10.2667 0.1C10.4338 0.166667 10.5782 0.266667 10.7 0.4L11.6167 1.33333C11.75 1.45556 11.8471 1.6 11.908 1.76667C11.9689 1.93333 11.9996 2.1 12 2.26667C12 2.44444 11.9693 2.614 11.908 2.77533C11.8467 2.93667 11.7496 3.08378 11.6167 3.21667L3.21667 11.6167C3.09444 11.7389 2.95267 11.8333 2.79133 11.9C2.63 11.9667 2.46067 12 2.28333 12H0.666667ZM8.31667 3.68333L7.85 3.2L8.8 4.15L8.31667 3.68333Z"
        fill="black"
      />
    </svg>
  );
}

export default function ProfileImageUpload({
  onImageChange,
}: {
  onImageChange: (file: File) => void;
}) {
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [previewUrl, setPreviewUrl] = useState<string | null>(null);

  const handleEditClick = () => {
    fileInputRef.current?.click();
  };

  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      if (previewUrl) {
        URL.revokeObjectURL(previewUrl);
      }

      const url = URL.createObjectURL(file);
      setPreviewUrl(url);
      onImageChange(file);
      console.log('선택된 파일:', file.name);
    }
  };

  return (
    <div className="relative w-[128px] h-[128px] mx-auto mt-[12px]">
      <div className="w-full h-full rounded-full overflow-hidden flex items-center justify-center bg-white border border-[#CCCCCC]">
        {previewUrl ? (
          <img
            src={previewUrl}
            alt="profile preview"
            className="w-full h-full object-cover"
          />
        ) : (
          <ProfilePlaceholder />
        )}
      </div>

      <button
        type="button"
        onClick={handleEditClick}
        className="absolute bottom-0 right-0 w-[28px] h-[28px] bg-[#FAFBFD] rounded-full shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] flex items-center justify-center hover:bg-gray-50 transition-all active:scale-95"
      >
        <PencilIcon />
      </button>

      <input
        type="file"
        ref={fileInputRef}
        onChange={handleFileChange}
        className="hidden"
        accept="image/*"
      />
    </div>
  );
}
